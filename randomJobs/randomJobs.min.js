(function(){'use strict';const g=[{},{}],m=g.map(a=>new l(a)),n={celsiusToFahrenheit:a=>1.8*a+32,feetToMeters:a=>.3048*a,metersToFeet:a=>a/.3048,milesToMeters:a=>1609.344*a,metersToMiles:a=>a/1609.344,kmToNm:a=>a/1.852,nmToKm:a=>1.852*a,inhgToKpa:a=>a/.29529988,kpaToInhg:a=>.29529988*a,kphToMps:a=>a/3600*1E3,mpsToKts:a=>1.9438445*a,ktsToMps:a=>a/1.9438445};function r(a,b={},c=""){const d=document.createElement(a);Object.keys(b||{}).forEach(e=>d.setAttribute(e,b[e]));(""+c).length&&(d.innerHTML=c);return d}function t(a,b,c={},d=-1){b=r(b,c);0>d?a.appendChild(b):a.insertBefore(b,a.children[d]);return b}function u(a){return function(b=1,c=0){let d=a+=1831565813;d=Math.imul(d^d>>>15,d|1);d^=d+Math.imul(d^d>>>7,d|61);return((d^d>>>14)>>>0)/4294967296*b+c}}function v(a=!1){return a?new Date/1E3:Math.floor(new Date/1E3)}function x(a){return("0"+a).slice(-2)}function y(a){return[x(a.getHours()),x(a.getMinutes())].join(":")}function z(a){return[a.getFullYear(),x(a.getMonth()+1),x(a.getDate())].join("-")}function B(a){return a.reduce((b,c)=>(b[c]=!0,b),{})}function C(a,b,c=!1){c&&b<a&&b.setDate(b.getDate()+1);return Math.round((b-a)/1E3)}function l(a){this.index=new Map;this.aList=a;this.int=b=>parseInt(Math.floor(b),10)}l.prototype.addPoint=function(a,b,c){b=this.int(b);c=this.int(c);-180>c?c+=360:180<c&&(c-=360);this.index.has(b)||this.index.set(b,new Map);this.index.get(b).has(c)||this.index.get(b).set(c,new Set);this.index.get(b).get(c).add(a)};l.prototype.nearbyIcao=function(a,b){return this.nearby(this.aList[a],b)};l.prototype.nearby=function(a,b){if(!a)return[];var c=9E-6*b;c=[[this.int(a[0]-c),this.int(a[0]+c)],[this.int(a[1]-c),this.int(a[1]+c)]];let d=new Set;for(let e=c[0][0];e<=c[0][1];e++)for(let f=c[1][0];f<=c[1][1];f++){let h=f;-180>f?h+=360:180<f&&(h-=360);this.index.has(e)&&this.index.get(e).has(h)&&(d=new Set([...d,...this.index.get(e).get(h)]))}return[...d].filter(e=>this.dist(...a,...this.aList[e])<=b).sort((e,f)=>this.distSq(...a,...this.aList[e])-this.distSq(...a,...this.aList[f]))};l.prototype.distSq=function(a,b,c,d){a=c-a;b=d-b;return a*a+b*b};l.prototype.dist=function(a,b,c,d){return geofs.api.map._map.distance({lat:a,lng:b},{lat:c,lng:d})};function D(a){void 0===localStorage&&(localStorage={setItem:()=>{},getItem:()=>{},removeItem:()=>{},length:0});const b=localStorage.getItem(a),c=JSON.parse(b||"{}");this.storageKey=a;this.has=d=>void 0!==c[d];this.get=d=>c[d];this.sync=()=>localStorage.setItem(a,JSON.stringify(c));this.set=(d,e)=>{c[d]=e;this.sync()};this.del=d=>{delete c[d];this.sync()};D.listStorageKeys=function(d){let e,f=[];for(e=0;e<localStorage.length;e++){const h=localStorage.key(e);d&&!(""+h).match(d)||f.push(h)}return f};D.removeStorageByKey=function(d){localStorage.removeItem(d)}}function E(a){const b=indexedDB.open(a.key);b.onsuccess=b.onupgradeneeded=c=>{this.db=c.target.result;Object.keys(a.stores).forEach(d=>this.db.objectStoreNames.contains(d)||this.db.createObjectStore(d,a.stores[d]));D.listStorageKeys("^RJFlightV1_").sort().reverse().forEach(d=>{const e=new D(d),f=e.get("flight");this.set("flights",f);this.set("tapes",{id:f.id,tape:e.get("tape")});this.set("routes",{id:f.id,route:e.get("route")});D.removeStorageByKey(d)});console.log("IDBDr success",this.db);this.db.onerror=d=>console.log("IDBD error",d,this.db);this.db.onabort=d=>console.log("IDBD abort",d,this.db);this.db.onclose=d=>console.log("IDBD closed",d,this.db)};b.onblocked=c=>console.log("IDBDr blocked",c);b.onerror=c=>console.log("IDBDr error",c);this.onGet=(c,d,e)=>{if(!this.db)return setTimeout(()=>this.onGet(c,d,e),100);try{this.db.transaction(c).objectStore(c).get(d).onsuccess=f=>e(f.target.result)}catch(f){console.log("IDBD get",d,f,this.db)}};this.promiseGet=(c,d)=>new Promise(e=>{this.db.transaction(c).objectStore(c).get(d).onsuccess=f=>e(f.target.result)});this.promiseGetAll=c=>new Promise(d=>{this.db.transaction(c).objectStore(c).getAll().onsuccess=e=>d(e.target.result)});this.set=(c,d)=>{if(!this.db)return setTimeout(()=>this.set(c,d),100);try{this.db.transaction(c,"readwrite").objectStore(c).put(d)}catch(e){console.log("IDBD set",d,e,this.db)}};this.del=(c,d)=>{this.db||setTimeout(()=>this.del(c,d),100);try{this.db.transaction(c,"readwrite").objectStore(c).delete(d)}catch(e){console.log("IDBD del",d,e,this.db)}}};(function F(){if(!geofs||!geofs.map||!geofs.map.addRunwayMarker)return setTimeout(F,1E3);const b=geofs.map.addRunwayMarker;geofs.map.addRunwayMarker=function(c){H(c);return b(c)};geofs.nav.loadNavaidsAndRunways();geofs.nav.loadFixes()})();function H(a){const [,b,c]=a.name.split("|");if(c&&c.length){const d=a.major?1:0;let e=g[d][c];if(void 0===e)e=[a.lat,a.lon,b];else{const [f,h,p]=e;e=[(f+a.lat)/2,(h+a.lon)/2,p||b]}g[d][c]=e}};function I(a,b,c){this.version=c;this.aList=a;this.aIndex=b;this.last={icao:"",time:0};this.airport={icao:void 0,major:void 0,nearby:{},jobs:[],max:[0,0]};this.window=null;this.store=new D("RJFlightV1");this.archive=new E({key:"RJFlightV1",stores:{flights:{keyPath:"id"},tapes:{keyPath:"id"},routes:{keyPath:"id"}}});this.aHandler=new J(this);this.flight=new K(this);this.generator=new L(this);this.rng=u((new Date).getHours())}I.prototype.init=function(a){Object.keys(g[0]).length||["major","minor"].forEach(b=>Object.values(geofs.api.map.markerLayers[b].tiles).forEach(c=>{c.forEach(d=>{d&&d.runway&&H(d.runway)})}));this.aList.forEach((b,c)=>Object.keys(b).forEach(d=>this.aIndex[c].addPoint(d,...b[d])));$.getJSON(`${"https://raw.githubusercontent.com/scitor/GeoFS/master"}/icaos.json?${v()}`,b=>{b.forEach(c=>g.push(c));this.aHandler.init();setInterval(()=>this.update(),1E3);a()})};I.prototype.update=function(){flight.recorder.playing||geofs.isPaused()||(this.updateCurrentAirport(),this.flight.update(),this.window&&this.window.update())};I.prototype.updateCurrentAirport=function(){const a=geofs.aircraft.instance.getCurrentCoordinates(),[b,c]=this.aHandler.getAirportNearby(a);b===this.last.icao&&v()<this.last.time+60||(this.airport.icao=b,this.airport.major=c,b?(this.rng=u(this.aHandler.getIcaoId(b)+(new Date).getHours()),this.airport.max=[30,70].map(d=>Math.round(this.rng(d,5)))):(this.airport.nearby={},this.airport.jobs=[]),b!==this.last.icao&&this.window&&this.window.reloadJobsList(),this.last.icao=b,this.last.time=v())};I.prototype.getIcao=function(){return this.airport.icao};I.prototype.removeHistoryEntry=function(a){this.archive.del("flights",a);this.archive.del("tapes",a);this.archive.del("routes",a)};I.prototype.getHistory=function(){return this.archive.promiseGetAll("flights")};I.prototype.getJobsList=function(){return[...this.airport.jobs]};I.prototype.sortJobsList=function(a){this.airport.jobs.sort(a)};I.prototype.generateJob=function(){const a=this.flight.getCurrent();if(this.airport.icao&&(!a||a.status!=M.AIRBORNE))return this.generator.generateJob()};I.prototype.generateFlightPlan=function(a,b){const c=[],d=this.aHandler.getAirportCoords(a),e=this.aHandler.getAirportCoords(b),f=this.aIndex[0].dist,h=f(...d,...e),p=[(d[0]+e[0])/2,(d[1]+e[1])/2];Object.keys(geofs.nav.fixes).forEach(k=>geofs.nav.fixes[k].forEach(w=>{const G=f(...p,...w);if(G<h/3){const W=f(...d,...w),X=f(...e,...w);c.push([...w,k,W,G,X])}}));a=[{ident:a,lat:d[0],lon:d[1]}];const A=c.sort((k,w)=>k[3]-w[3])[0];A&&a.push({ident:A[2],lat:A[0],lon:A[1]});if(5E5<h&&1E6>h){const k=c.sort((w,G)=>w[4]-G[4])[0];k&&!a.find(w=>w.ident==k[2])&&a.push({ident:k[2],lat:k[0],lon:k[1]})}const q=c.sort((k,w)=>k[5]-w[5])[0];q&&!a.find(k=>k.ident==q[2])&&a.push({ident:q[2],lat:q[0],lon:q[1]});1==a.length&&a.push({ident:"FIX",lat:p[0],lon:p[1]});a.push({ident:b,lat:e[0],lon:e[1]});geofs.flightPlan.clear();geofs.flightPlan.trackedWaypoint=void 0;geofs.flightPlan.waypointArray.forEach(k=>k.navaid&&k.navaid.fromFlightPlan&&geofs.nav.removeNavaid(k.navaid.id));geofs.flightPlan.waypointArray=a.map(k=>Object.assign({type:"fix",alt:"",spd:""},k)).map(k=>{k.lat+=1E-6;k.lon+=1E-6;return k});geofs.flightPlan.refreshWaypoints();geofs.flightPlan.isOpen||geofs.flightPlan.toggle();return c};function J(a){this.airport=a.airport;this.aIndex=a.aIndex;this.aList=a.aList;this.aInfo={}}J.prototype.init=function(){this.aList[3].forEach((a,b)=>{const [c,d,e]=a.split("|");this.aInfo[c]={id:b,iata:d,icao:c,name:e}})};J.prototype.hasAIcon=function(a){return this.aList[7][a[0]]&&this.aList[7][a[0]][a[1]]&&this.aList[7][a[0]][a[1]][a[2]]};J.prototype.getAInfo=function(a){return 1==a.length?{icao:a,iata:a,name:this.getRegionalsName(a)}:this.aInfo[a]};J.prototype.getIATAInfo=function(a){return 1==a.length?{icao:a,iata:a,name:this.getRegionalsName(a)}:Object.values(this.aInfo).find(b=>b.iata==a)};J.prototype.getIcaoId=function(a){if(!a||!a.length)return 0;const b=this.aList[2].indexOf(a);return-1==b?(this.aList[2].push(a),this.aList[2].length-1):b};J.prototype.getListStr=function(a){return 0===a?"":this.aList[5][a]};J.prototype.getAirportNearby=function(a){const b=[0,1].map(c=>this.aIndex[c].nearby([a[0],a[1]],5E3)[0]);if(b[0]&&b[1]){const c=b.map((d,e)=>this.aList[e][d]);return this.aIndex[0].dist(...a,...c[0])<this.aIndex[1].dist(...a,...c[1])?[b[0],0]:[b[1],1]}return b[0]?[b[0],0]:b[1]?[b[1],1]:[null,null]};J.prototype.getNearbyAirports=function(a,b){void 0===this.airport.nearby[b]&&(this.airport.nearby[b]=[0,1].map(c=>this.aIndex[c].nearby([a[0],a[1]],b)));return this.airport.nearby[b]};J.prototype.fetchAirportWeather=function(a,b){void 0!==window.METAR?b(window.METAR[a]):b()};J.prototype.getAirportDist=function(a,b){try{return this.aIndex[0].dist(...this.getAirportCoords(a),...this.getAirportCoords(b))}catch(c){return console.log(a,b,c),0}};J.prototype.getAirportCoords=function(a){if(this.aList[0][a])return[this.aList[0][a][0],this.aList[0][a][1]];if(this.aList[1][a])return[this.aList[1][a][0],this.aList[1][a][1]]};J.prototype.getAirportName=function(a){if(this.aList[0][a])return this.aList[0][a][2];if(this.aList[1][a])return this.aList[1][a][2]};J.prototype.getAirportInfo=function(a){const b={elevation:"",iata:"",country:"",state:"",city:"",name:"",tz:""},c=this.aList[2].indexOf(a);return-1!=c&&this.aList[6][c]?"elevation iata country state city name tz".split(" ").reduce((d,e,f)=>{d[e]="elevation"==e?this.aList[6][c][f]:this.getListStr(this.aList[6][c][f]);return d},b):b};J.prototype.getRegionalsName=function(a){return{A:"Aerofleet Airways",B:"BlueWave Airlines",C:"Cloudline Aviation",D:"DreamSky Airlines",E:"Eclipse Air",F:"Freedom Flyers",G:"Galaxy Wings",H:"Horizon Vista Airways",I:"Infinity Airlines",J:"Jetstream Airways",K:"Keystone Airlines",L:"Luminary Airlines",M:"Meridian Air",N:"Northern Lights Air",O:"Odyssey Air",P:"Phoenix Wings",Q:"Quantum Air",R:"Radiant Airlines",S:"SkyBound Airlines",T:"TranquilAirways",U:"Uplift Airlines",V:"Vortex Skyways",W:"Windward Jet",X:"Xenon Air",Y:"Yonder Airways",Z:"Zenith Sky"}[a.toLocaleUpperCase()]};const M={PLANING:"planing",DEPARTURE:"departure",ONGROUND:"on ground",AIRBORNE:"airborne",ARRIVAL:"arrival",DIVERTED:"diverted",CRASHED:"crashed",ABORTED:"aborted",FINISHED:"finished"};function K(a){this.aHandler=a.aHandler;this.airport=a.airport;this.store=a.store;this.archive=a.archive;this.restoreState();this.resetTracker()}K.prototype.getStatus=function(){return this.store.get("currentFlight")?.status};K.prototype.getCurrent=function(){return this.store.get("currentFlight")};K.prototype.setCurrent=function(a){a.id||(a.id=Date.now());a.status||(a.status=M.PLANING);return this.store.set("currentFlight",a)};K.prototype.clearCurrent=function(){return this.store.del("currentFlight")};K.prototype.sync=function(){this.store.sync()};K.prototype.hasOrigin=function(){const a=this.getCurrent();return a&&a.orgn&&!!this.aHandler.getAirportCoords(a.orgn)};K.prototype.getOrigin=function(){const a=this.getCurrent();return a&&a.orgn};K.prototype.hasDestination=function(){const a=this.getCurrent();return a&&a.dest&&!!this.aHandler.getAirportCoords(a.dest)};K.prototype.getDestination=function(){const a=this.getCurrent();return a&&a.dest};K.prototype.startFlight=function(){const a=this.getCurrent();a&&(a.dist=1.1*this.aHandler.getAirportDist(a.orgn,a.dest),a.status=M.DEPARTURE,this.startTracking())};K.prototype.finishFlight=function(){const a=this.getCurrent();a&&(a.traveled||(a.traveled=0),a.status!=M.ARRIVAL&&(a.finished=a.status),a.status=M.FINISHED,this.stopTracking(),this.archiveFlight())};K.prototype.cancelFlight=function(){const a=this.getCurrent();a&&(a.status=M.ABORTED,this.store.sync())};K.prototype.resetFlight=function(){this.setCurrent({})};K.prototype.restoreState=function(){this.archive.onGet("tapes",0,a=>{a&&(this.flightTape=a.tape)})};K.prototype.resetTracker=function(){this.tracker={time:v(!0),airborneTime:0,groundTime:0,airspeed:0};this.flightTape=[];this.archive.del("tapes",0);this.archive.del("routes",0)};K.prototype.stopTracking=function(){const a=this.getCurrent();if(a&&a.times){a.times.end=v();if(void 0!==a.arrvtime){const b=new Date(1E3*a.times.end),c=new Date;c.setHours(...a.arrvtime.split(":"));a.delay=C(c,b)}this.sync()}};K.prototype.startTracking=function(){const a=this.getCurrent();if(a){this.resetTracker();a.times={start:v(),takeoff:0,landing:0,end:0};if(void 0!==a.depttime){const b=new Date(1E3*a.times.start),c=new Date;c.setHours(...a.depttime.split(":"));a.delay=C(c,b)}this.sync()}};K.prototype.getAvgAirspeed=function(){return this.tracker&&this.tracker.airspeed};K.prototype.archiveFlight=function(){const a=this.getCurrent();a&&a.id&&localStorage&&(this.archive.del("tapes",0),this.archive.set("flights",a),this.archive.set("tapes",{id:a.id,tape:this.flightTape}))};K.prototype.tapeRecord=function(){const a=window.flight.recorder.makeRecord(),b="ti co ct st ve acc".split(" ").reduce((c,d)=>{d=a[d];void 0!==d.map?c.push(d.map(e=>"number"===typeof e?parseFloat(e.toFixed(6)):e)):c.push(parseFloat(d.toFixed(2)));return c},[]);this.flightTape.push(b)};const N=B([M.ONGROUND,M.DEPARTURE,M.AIRBORNE,M.ARRIVAL,M.ABORTED,M.DIVERTED]);K.prototype.update=function(){const a=this.getCurrent();if(a&&N[a.status]){var b=this.tracker;b.time=v(!0);var c=a.times,d=geofs.aircraft.instance;d.groundContact||d.waterContact?(a.groundTime=(a.groundTime||0)+1,b.groundTime+=1,b.airborneTime=0,b.airspeed=0,a.taxiDist=(a.taxiDist||0)+1*d.groundSpeed):(a.airborneTime=(a.airborneTime||0)+1,b.airborneTime+=1,b.groundTime=0,b.airspeed=(29*(b.airspeed||d.trueAirSpeed)+d.trueAirSpeed)/30,a.traveled=(a.traveled||0)+1*d.groundSpeed);0==this.flightTape.length%120&&this.archive.set("tapes",{id:0,tape:this.flightTape});this.tapeRecord();setTimeout(()=>this.tapeRecord(),500);switch(a.status){case M.ONGROUND:case M.DEPARTURE:if(5>b.airborneTime||10>d.groundSpeed)break;a.status=M.AIRBORNE;c.takeoff||(c.takeoff=v()-b.airborneTime);break;case M.AIRBORNE:if(!(5>b.groundTime)){var e=this.airport.icao;e?(a.status=e==a.dest?M.ARRIVAL:e==a.orgn?M.ABORTED:M.DIVERTED,c.landing=v()-b.groundTime):a.status=M.ONGROUND;d.crashed&&(a.status=M.CRASHED,a.crashed=!0);c.landing||(c.landing=v()-b.groundTime)}}this.sync()}};function L(a){this.aHandler=a.aHandler;this.aList=a.aList;this.airport=a.airport;this.rng=(b=1,c=0)=>a.rng(b,c)}L.prototype.chance=function(a){return this.rng()<(1<a?a/100:a)};L.prototype.randomEl=function(a){return a[Math.floor(this.rng()*a.length)]};L.prototype.hasJob=function(a,b,c=null){return this.airport.jobs.find(d=>d.orgn==a&&d.dest==b&&(!c||d.airline==c))};L.prototype.generateJob=function(){const a=this.generateAirlineJob()||this.generateRegionalJob();if(a)return this.airport.jobs.push(a),!0};L.prototype.generateAirlineJob=function(){if(!(this.airport.jobs.filter(c=>!c.regional).length>this.airport.max[0])){var a,b=this.aList[4][this.aList[2].indexOf(this.airport.icao)];if(b)return Object.keys(b).find(c=>b[c].find(d=>{const e=this.aList[2][c];if(void 0!=this.aHandler.getAirportName(e)&&!this.hasJob(this.airport.icao,e,this.aList[3][d].split("|")[0]))return a=this.createJobObj(this.airport.icao,e,this.aList[3][d].split("|")[0]),!0})),a}};L.prototype.generateRegionalJob=function(){if(!(this.airport.jobs.filter(e=>e.regional).length>this.airport.max[1])){var a,b=geofs.aircraft.instance.getCurrentCoordinates(),c=this.airport.major?{range:10,tries:[{major:1,chance:1/3},{major:0,chance:1/3}]}:{range:5,tries:[{major:0,chance:1/3},{major:1,chance:1}]},d=1E5;for(let e=1;e<=c.range;e++){d=1E5*e;const f=this.aHandler.getNearbyAirports(b,n.nmToKm(d));c.tries.find(h=>{const p=f[h.major].indexOf(this.airport.icao);-1<p&&f[h.major].splice(p,1);if(f[h.major].length&&(1===h.chance||this.chance(h.chance))&&(h=this.randomEl(f[h.major]),!this.hasJob(this.airport.icao,h)))return a=this.createJobObj(this.airport.icao,h),!0});if(a)return a}}};L.prototype.createJobObj=function(a,b,c){let d=!0;if(c){var e=this.aHandler.getAInfo(c);d=!1;e=(e.iata||e.icao)+Math.round(100+Math.sqrt(this.rng(1E6)))}else c=String.fromCharCode(Math.round(this.rng(25,65))),e=c+"-"+Math.round(Math.sqrt(this.rng(1E4)));const f=this.aHandler.getAirportDist(a,b);return{flightno:e,regional:d,dist:f,orgn:a,dest:b,airline:c}};function O(a){this.mod=a;a.window=this;this.last={icao:"",time:0}}O.prototype.init=function(){$.get(`${"https://raw.githubusercontent.com/scitor/GeoFS/master"}/randomJobs/styles.css?${v()}`,b=>{document.head.appendChild(r("style",{type:"text/css"},b))});$.get(`${"https://raw.githubusercontent.com/scitor/GeoFS/master"}/randomJobs/flags16.css?${v()}`,b=>{document.head.appendChild(r("style",{type:"text/css"},b))});$.get(`${"https://raw.githubusercontent.com/scitor/GeoFS/master"}/randomJobs/airlines.css?${v()}`,b=>{document.head.appendChild(r("style",{type:"text/css"},b.replace("{githubRepo}","https://raw.githubusercontent.com/scitor/GeoFS/master")))});const a=$(".geofs-ui-right")[0];this.ctrlPadDom=t(a,"div",{class:"jobs-pad"},1);this.padLabelDom=t(this.ctrlPadDom,"div",{class:"control-pad-label transp-pad"});this.padLabelDom.innerHTML="JOBS";this.padLabelDom.onclick=b=>this.toggleWindow(b);this.jobsWindowDom=t(document.body,"div",{class:"jobs-window"});this.jobsWindowDom.innerHTML='<p style="text-align:center;">... initializing ...</p>';this.jobsWindowDom.style.left=2*window.innerWidth+"px";this.jobsWindowDom.style.display="none";$.get(`${"https://raw.githubusercontent.com/scitor/GeoFS/master"}/randomJobs/window.html?${v()}`,b=>{this.populate(b);this.jobsWindowDom.style.display=""})};O.prototype.populate=function(a){this.jobsWindowDom.innerHTML=a;this.headerDom={title:this.jobsWindowDom.querySelector(".jobs-title"),locinfo:this.jobsWindowDom.querySelector(".locinfo"),coords:this.jobsWindowDom.querySelector(".coords"),metar:this.jobsWindowDom.querySelector(".metar")};this.footerDom=this.jobsWindowDom.querySelector(".jobs-footer");this.footerDom.innerHTML="Random Jobs v"+this.mod.version;this.footerDom.onclick=b=>this.handleMainMenu(b);this.mainMenuDom=this.jobsWindowDom.querySelector(".jobs-menu");this.mainMenuDom.onclick=b=>this.handleMainMenu(b);this.contentDom=this.jobsWindowDom.querySelector(".jobs-content");this.jobsPage=new P(this);this.jobsPage.populate(this.contentDom.querySelector(".page-jobs"));this.flightPage=new Q(this);this.flightPage.populate(this.contentDom.querySelector(".page-flight"));this.careerPage=new R(this);this.careerPage.populate(this.contentDom.querySelector(".page-career"));this.headerDom.metar.onclick=()=>this.windyPopup();this.makeDraggable(this.headerDom.title);this.makeScalable(this.headerDom.title);this.makeScalable(this.footerDom);this.jobsWindowDom.onkeydown=this.jobsWindowDom.onkeyup=this.jobsWindowDom.onkeypress=function(b){b.stopImmediatePropagation()};this.populated=!0};let S=1;O.prototype.makeScalable=function(a){const b=this.jobsWindowDom;a.onwheel=c=>{S=Math.min(1,Math.max(.5,S+(0>c.deltaY?.1:-.1)));b.style.scale=S}};O.prototype.makeDraggable=function(a){function b(f){f.preventDefault();e.style.left=f.clientX-d[0]+"px";e.style.top=f.clientY-d[1]+"px";e.style.transition="none"}function c(){e.style.transition="";a.removeEventListener("mouseup",c);document.removeEventListener("mousemove",b)}const d=[0,0],e=this.jobsWindowDom;a.onmousedown=f=>{f.preventDefault();d[0]=f.clientX-e.offsetLeft;d[1]=f.clientY-e.offsetTop;a.addEventListener("mouseup",c);document.addEventListener("mousemove",b)}};O.prototype.windyPopup=function(){var a=this.mod.airport.icao;a&&(a=this.mod.aHandler.getAirportCoords(a))&&window.open("https://embed.windy.com/embed.html?type=map&location=coordinates&zoom=7&lat="+a[0]+"&lon="+a[1],"_blank","popup=1",!1)};let T=!0;O.prototype.toggleWindow=function(a){a.target==this.padLabelDom&&(this.padLabelDom.classList.contains("blue-pad")?(this.padLabelDom.classList.remove("blue-pad"),this.ctrlPadDom.classList.remove("open"),this.jobsWindowDom.dataset.left=this.jobsWindowDom.style.left,this.jobsWindowDom.style.left=2*window.innerWidth+"px"):(this.padLabelDom.classList.add("blue-pad"),this.ctrlPadDom.classList.add("open"),this.jobsWindowDom.style.left=this.jobsWindowDom.dataset.left?this.jobsWindowDom.dataset.left:window.innerWidth-this.jobsWindowDom.offsetWidth-80+"px",T&&(this.mainMenuDom.querySelector("li[data-id=flight]").click(),T=!1)))};O.prototype.handleMainMenu=function(a){if(a.target instanceof HTMLElement){var b=a.target.dataset.id;this.contentDom.querySelectorAll(":scope > div").forEach(c=>{const d=c.classList.contains("page-"+b);c.style.display=d?"":"none"});this.mainMenuDom.querySelectorAll("ul > li").forEach(c=>{c.dataset.id==b?c.classList.add("active"):c.classList.remove("active")});this._activeMenu=b;switch(b){case "jobs":this.jobsPage.reloadList();break;case "flight":this.flightPage.updateForm();break;case "career":this.careerPage.reloadList()}}};O.prototype.update=function(){this.populated&&(this.updateHeader(),"flight"==this._activeMenu&&(this.flightPage.refreshDisplays(),this.flightPage.handleActiveButtons()))};O.prototype.reloadJobsList=function(){this.jobsPage.reloadList()};O.prototype.updateHeader=function(){const a=this.headerDom;if(geofs.aircraft.instance.groundContact||geofs.aircraft.instance.waterContact){var b=this.mod.airport.icao;if(b!==this.last.icao){if(b){const d=this.mod.aHandler.getAirportInfo(b);var c=this.mod.aHandler.getAirportName(b)||d.name;a.title.innerHTML=c.replace(" International "," Intl. ").replace(/ Airport$/,"");c=b;d.iata&&(c+=" ("+d.iata+")");d.city&&(c+=", "+d.city);d.state&&(c+=", "+d.state);d.country&&(c=r("a",{class:"flag "+d.country.toLowerCase(),title:d.country}).outerHTML+c);a.locinfo.innerHTML=c;c=this.mod.aHandler.getAirportCoords(b);a.coords.innerHTML="Coords "+c.map(e=>e.toFixed(4)).join(", ");a.coords.innerHTML+=", Elevation "+d.elevation+" ft";a.metar.innerHTML="METAR: receiving ...";this.mod.aHandler.fetchAirportWeather(b,e=>{if(e&&e.METAR){a.metar.innerHTML="METAR:";const f=Object.keys(e).map(h=>h+":"+e[h]).join("\n");a.metar.appendChild(r("a",{title:f},e.METAR));e.altimHg&&(a.coords.innerHTML+=", inHg:"+e.altimHg);e.fltCat&&(a.coords.innerHTML+=" ("+e.fltCat+")")}else a.metar.innerHTML="METAR: INOP"})}else a.title.innerHTML="... no airport nearby ...",a.locinfo.innerHTML="",a.coords.innerHTML="",a.metar.innerHTML="";this.last.icao=b}}else a.title.innerHTML="AIRBORNE",a.locinfo.innerHTML="ALT SPEED HDG ETE",a.coords.innerHTML="",a.metar.innerHTML=""};function P(a){this.window=a;this.mod=a.mod}P.prototype.populate=function(a){this.dom={listHeader:a.querySelector("div"),list:a.querySelector("ul"),loadButton:a.querySelector("input")};this.dom.listHeader.onclick=b=>this.sortList(b);this.dom.loadButton.onclick=()=>this.loadJobs()};P.prototype.loadJobs=function(){for(let a=0;20>a;++a)this.mod.generateJob();this.reloadList()};P.prototype.sortList=function(a){a=a.target;let b;this._lastSort=!this._lastSort;a==this.dom.listHeader.children[0]?b=(c,d)=>c.regional-d.regional||(this._lastSort?c.flightno.localeCompare(d.flightno):d.flightno.localeCompare(c.flightno)):a==this.dom.listHeader.children[1]?b=(c,d)=>c.regional-d.regional||(this._lastSort?c.dest.localeCompare(d.dest):d.dest.localeCompare(c.dest)):a==this.dom.listHeader.children[2]&&(b=(c,d)=>c.regional-d.regional||(this._lastSort?d.dist-c.dist:c.dist-d.dist));b&&this.mod.sortJobsList(b);this.reloadList()};P.prototype.reloadList=function(){this.dom.list.innerHTML="";this.mod.getJobsList().forEach(a=>{var b=t(this.dom.list,"li",{class:"list-entry"}),c="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/airline.png";let d="";a.regional?c="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/regional.png":this.mod.aHandler.hasAIcon(a.airline)&&(c="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/com.png",d="airline-icon icao-"+a.airline);const e=t(b,"div",{class:"flightno"}),f=this.mod.aHandler.getAInfo(a.airline);t(e,"img",{src:c,alt:f.name,title:f.name,class:d});e.appendChild(r("span",{},a.flightno));b.appendChild(r("div",{class:"dest"},a.dest));b.appendChild(r("div",{class:"dist"},Math.round(n.kmToNm(a.dist/1E3))+"NM"));b=t(b,"div",{class:"actions"});c=t(b,"button",{class:"action-plan mdl-button--icon"});c.appendChild(r("i",{class:"material-icons"},"insights"));c.onclick=()=>{ui.panel.show(".geofs-map-list");this.mod.generateFlightPlan(a.orgn,a.dest)};b=t(b,"button",{class:"action-plan mdl-button--icon"});b.appendChild(r("i",{class:"material-icons"},"airplane_ticket"));b.onclick=()=>{this.mod.flight.setCurrent(Object.assign({},a));this.window.mainMenuDom.querySelector("li[data-id=flight]").click()}})};function Q(a){this.window=a;this.jobMngr=a.mod}Q.prototype.populate=function(a){this.buttonsDom={resetFlight:a.querySelector("#flight-reset"),cancelFlight:a.querySelector("#flight-cancel"),startFlight:a.querySelector("#flight-start"),finishFlight:a.querySelector("#flight-finish")};this.inputsDom={flightno:a.querySelector("#flight-number"),tailno:a.querySelector("#flight-tailnumber"),orgn:a.querySelector("#flight-origin-icao"),dest:a.querySelector("#flight-destination-icao"),depttime:a.querySelector("#flight-departure-scheduled"),arrvtime:a.querySelector("#flight-arrival-scheduled")};this.displaysDom={depttimeActual:a.querySelector("#flight-departure-actual"),arrvtimeActual:a.querySelector("#flight-arrival-actual"),arrvtimeActualLabel:a.querySelector("#flight-arrival-actual").previousSibling,speedAvg:a.querySelector("#flight-speed-avg"),traveled:a.querySelector("#flight-traveled"),delay:a.querySelector("#flight-delay"),delayLabel:a.querySelector("#flight-delay").previousSibling,duration:a.querySelector("#flight-duration"),durationLabel:a.querySelector("#flight-duration").previousSibling};this.flightStatusDom=a.querySelector(".flight-status");this.airlineInfoDom=a.querySelector(".airline-info");this.destInfoDom=a.querySelector(".destination-info");this.destInfoDom.onclick=()=>this.windyPopup();Object.keys(this.inputsDom).forEach(b=>{const c=this.inputsDom[b];c.onchange=()=>this.handleInputChange(b);c.setAttribute("autocomplete","off");c.setAttribute("aria-autocomplete","off");c.setAttribute("list","autocompleteOff")});this.buttonsDom.resetFlight.onclick=()=>this.resetFlight();this.buttonsDom.cancelFlight.onclick=()=>this.cancelFlight();this.buttonsDom.startFlight.onclick=()=>this.startFlight();this.buttonsDom.finishFlight.onclick=()=>this.finishFlight()};Q.prototype.finishFlight=function(){Object.values(this.inputsDom).forEach(a=>{a.disabled=!1;a.parentNode.classList.remove("disabled")});this.jobMngr.flight.finishFlight();this.updateForm()};Q.prototype.startFlight=function(){Object.values(this.inputsDom).forEach(a=>{a.disabled=!0;a.parentNode.classList.add("disabled")});this.jobMngr.flight.startFlight();this.updateForm()};Q.prototype.cancelFlight=function(){Object.values(this.inputsDom).forEach(a=>{a.disabled=!1;a.parentNode.classList.remove("disabled")});this.jobMngr.flight.cancelFlight();this.updateForm()};Q.prototype.resetFlight=function(){Object.values(this.inputsDom).forEach(a=>{a.disabled=!1;a.parentNode.classList.remove("disabled")});this.jobMngr.flight.resetFlight();this.updateForm();this.refreshDisplays()};Q.prototype.handleInputChange=function(a){const b=this.jobMngr.flight.getCurrent();if(b){if("depttime"==a||"arrvtime"==a){var c=this.inputsDom[a].value.trim();c=(c=c.match(/^(\d{2}):?(\d{0,2})$/))&&c[1]?[c[1],((c[2]||"0")+"0").slice(0,2)].join(":"):"";this.inputsDom[a].value=b[a]=c}else b[a]=this.inputsDom[a].value.toLocaleUpperCase();this.jobMngr.flight.sync()}this.updateForm()};Q.prototype.windyPopup=function(){var a=this.jobMngr.flight.getCurrent();a&&a.dest&&(a=this.jobMngr.aHandler.getAirportCoords(a.dest))&&window.open("https://embed.windy.com/embed.html?type=map&location=coordinates&zoom=7&lat="+a[0]+"&lon="+a[1],"_blank","popup=1",!1)};Q.prototype.buttonMask=function(a,b,c,d){a?$(this.buttonsDom.resetFlight).show():$(this.buttonsDom.resetFlight).hide();b?$(this.buttonsDom.cancelFlight).show():$(this.buttonsDom.cancelFlight).hide();c?$(this.buttonsDom.startFlight).show():$(this.buttonsDom.startFlight).hide();d?$(this.buttonsDom.finishFlight).show():$(this.buttonsDom.finishFlight).hide()};Q.prototype.handleButtonVisibility=function(a){a==M.PLANING||a==M.FINISHED?this.buttonMask(1,0,1,0):a==M.ABORTED||a==M.CRASHED?this.buttonMask(1,0,0,1):this.buttonMask(0,1,0,1)};const U=B([M.ARRIVAL,M.DIVERTED,M.ABORTED,M.CRASHED]);Q.prototype.handleActiveButtons=function(){const a=this.jobMngr.flight,b=[],c=[],d=a.getStatus();d==M.PLANING&&(a.hasOrigin()?a.getOrigin()!=this.jobMngr.airport.icao&&b.push("Not at origin airport!"):(b.push("No origin entered!"),c.push("No origin entered!")));a.hasDestination()?a.hasDestination()&&a.getDestination()!=this.jobMngr.airport.icao&&(U[d]||c.push("Not at destination airport!")):(b.push("No destination entered!"),c.push("No destination entered!"));geofs.aircraft.instance.groundContact||(b.push("Still airborne!"),c.push("Still airborne!"));1<geofs.aircraft.instance.groundSpeed&&(b.push("Airplane moving!"),c.push("Airplane moving!"));geofs.aircraft.instance.brakesOn||(b.push("Parking brake not set!"),c.push("Parking brake not set!"));d!=M.PLANING&&b.push("Start planning flight first");U[d]||c.push("Complete flight phase first");d==M.PLANING&&(this.flightStatusDom.innerHTML=b[0]||"");this.buttonsDom.startFlight.title=b.join("\n")||"Ready to depart!";this.buttonsDom.startFlight.disabled=0<b.length;d==M.ARRIVAL&&(this.flightStatusDom.innerHTML=c[0]||M.ARRIVAL.toUpperCase());this.buttonsDom.finishFlight.title=c.join("\n")||"Ready to deboard!";this.buttonsDom.finishFlight.disabled=0<c.length};const V="flightno tailno orgn dest depttime arrvtime".split(" ");Q.prototype.updateForm=function(){const a=this.jobMngr.flight.getCurrent();if(!a)return V.forEach(c=>{this.inputsDom[c].value=""}),this.airlineInfoDom.innerHTML="",this.destInfoDom.innerHTML="",this.buttonMask(1,0,1,0);this.handleButtonVisibility(a.status);V.forEach(c=>{this.inputsDom[c].value=a[c]||""});a.airline="";if(a.flightno&&a.flightno.length){var b=this.jobMngr.aHandler.getIATAInfo(a.flightno.substr(0,2));b||=this.jobMngr.aHandler.getIATAInfo(a.flightno[0]);b&&(a.airline=b.icao,this.updateAirlineInfo(a.airline))}a.airline||(this.airlineInfoDom.innerHTML="");a.dest&&3<a.dest.length?(b=a.dest.toLocaleUpperCase(),this.updateDestinationInfo(b)):this.destInfoDom.innerHTML=""};Q.prototype.updateAirlineInfo=function(a){if(3==a.length){const b=this.jobMngr.aHandler.getAInfo(a);if(b){let c,d;this.jobMngr.aHandler.hasAIcon(b.icao)?(c="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/com.png",d="airline-icon icao-"+a):c="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/airline.png";this.airlineInfoDom.innerHTML=r("img",{src:c,class:d}).outerHTML+b.name}}else 1==a.length&&(this.airlineInfoDom.innerHTML=r("img",{src:"https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/regional.png"}).outerHTML,this.airlineInfoDom.innerHTML+=this.jobMngr.aHandler.getRegionalsName(a))};Q.prototype.updateDestinationInfo=function(a){const b=this.jobMngr.aHandler.getAirportInfo(a);let c=this.jobMngr.aHandler.getAirportName(a),d="";b&&(c=c||b.name,b.country&&(c=r("a",{class:"flag "+b.country.toLowerCase(),title:b.country}).outerHTML+c),b.iata&&(d+=" ("+b.iata+")"),b.city&&(d+=", "+b.city),this.jobMngr.aHandler.fetchAirportWeather(a,e=>{if(e&&e.METAR){let f="";e.altimHg&&(f+=" inHg:"+e.altimHg);e.fltCat&&(f+=" ("+e.fltCat+")");const h=Object.keys(e).map(p=>p+":"+e[p]).join("\n");d+=r("a",{title:h},f).outerHTML;this.destInfoDom.innerHTML=c.replace(" International "," Intl. ").replace(/ Airport$/,"");this.destInfoDom.innerHTML+=r("small",{},d).outerHTML}}));this.destInfoDom.innerHTML=c.replace(" International "," Intl. ").replace(/ Airport$/,"");this.destInfoDom.innerHTML+=r("small",{},d).outerHTML};const Y="depttimeActual arrvtimeActual speedAvg traveled delay duration".split(" ");Q.prototype.refreshDisplays=function(){var a=this.jobMngr.flight.getCurrent();const b=this.displaysDom;if(a&&a.status!=M.PLANING){if(a.finished?this.flightStatusDom.innerHTML=a.finished.toLocaleUpperCase():a.status!=M.ARRIVAL&&(this.flightStatusDom.innerHTML=a.status.replace(M.AIRBORNE,"in flight").toLocaleUpperCase()),a.times){b.traveled.value=Math.round(n.kmToNm(a.traveled/1E3))||"";if(a.delay){var c=Math.abs(a.delay);b.delay.value=[x(Math.floor(c/3600)),x(Math.round(c/60)%60)].join(":");b.delayLabel.nodeValue=0>a.delay?"Early":900<a.delay?"Delay":"On Time"}c=(a.airborneTime||0)+(a.groundTime||0);b.duration.value=[x(Math.floor(c/3600)),x(Math.floor(c/60)%60)].join(":");b.durationLabel.nodeValue=a.times.end||!a.times.takeoff?"Duration":"Duration (air)";b.speedAvg.value=Math.round(n.mpsToKts(1E3<a.traveled&&60<(a.airborneTime||0)?a.traveled/a.airborneTime:0))||"";a.times.start&&(b.depttimeActual.value=y(new Date(1E3*a.times.start)));a.times.end?(b.arrvtimeActual.value=y(new Date(1E3*a.times.end)),b.arrvtimeActualLabel.nodeValue="Actual Arr"):a.status==M.AIRBORNE&&this.jobMngr.flight.getAvgAirspeed()&&(c=Math.max(0,Math.round((a.dist-a.traveled)/this.jobMngr.flight.getAvgAirspeed())),a=a.times.takeoff&&a.times.start?a.times.takeoff-a.times.start:0,a=new Date(1E3*(v()+c+a)),b.arrvtimeActual.value=(new Date).getDay()!=a.getDay()?"+":"",b.arrvtimeActual.value+=[x(a.getHours()),x(a.getMinutes())].join(":"),b.arrvtimeActualLabel.nodeValue="Estimated Arr")}}else Y.forEach(d=>{b[d].value=""}),b.arrvtimeActualLabel.nodeValue="Actual Arr",b.delayLabel.nodeValue="On Time",b.durationLabel.nodeValue="Duration"};function R(a){this.window=a;this.mod=a.mod;this._listCols={flightno:0,dest:0,dist:0,actions:0}}R.prototype.populate=function(a){this.dom={listHeader:a.querySelector("div"),list:a.querySelector("ul")};this.dom.listHeader.onclick=b=>this.toggleCols(b)};R.prototype.toggleCols=function(a){a=a.target;if(a==this.dom.listHeader.children[0]){var b=["Airline / Flight","Dept Time"];this._listCols.flightno=((this._listCols.flightno||0)+1)%b.length;a.innerHTML=b[this._listCols.flightno]}else a==this.dom.listHeader.children[1]?(b=["Destination","Origin"],this._listCols.dest=((this._listCols.dest||0)+1)%b.length,a.innerHTML=b[this._listCols.dest]):a==this.dom.listHeader.children[2]?(b=["Traveled","Duration","Avg kts"],this._listCols.dist=((this._listCols.dist||0)+1)%b.length,a.innerHTML=b[this._listCols.dist]):a==this.dom.listHeader.children[3]&&(b=["\u2610","\u2611","\u2612"],this._listCols.actions=((this._listCols.actions||0)+1)%b.length,a.innerHTML=b[this._listCols.actions]);this.reloadList()};R.prototype.reloadList=async function(){const a=await this.mod.getHistory();let b="";this.dom.list.innerHTML="";a.sort((c,d)=>d.id-c.id);a.forEach(c=>{var d=z(new Date(1E3*c.times.start));b!=d&&(t(this.dom.list,"li",{class:"date-entry"}).innerText=b=d);d=t(this.dom.list,"li",{class:"list-entry"});if(0===this._listCols.flightno){var e="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/airline.png";if(c.regional)e="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/regional.png";else if(this.mod.aHandler.hasAIcon(c.airline)){e="https://raw.githubusercontent.com/scitor/GeoFS/master/randomJobs/com.png";var f="airline-icon icao-"+c.airline}const p=t(d,"div",{class:"flightno"}),A=this.mod.aHandler.getAInfo(c.airline);t(p,"img",{src:e,alt:A.name,title:A.name,referrerpolicy:"no-referrer",class:f});p.appendChild(r("span",{},c.flightno))}else 1===this._listCols.flightno&&t(d,"div",{class:"flightno"}).appendChild(r("span",{},(c.depttime||"")+" ("+y(new Date(1E3*c.times.start))+")"));d.appendChild(r("div",{class:"dest"},0===this._listCols.dest?c.dest:c.orgn));const h=c.times.end-c.times.start||0;f=c.traveled||0;e="";e=0===this._listCols.dist?Math.round(n.kmToNm(f/1E3))+"NM":2===this._listCols.dist?Math.round(n.mpsToKts(f/h)):[x(Math.floor(h/3600)),x(Math.floor(h/60)%60)].join(":");d.appendChild(r("div",{class:"dist"},e));d=t(d,"div",{class:"actions"});0===this._listCols.actions?(f=t(d,"button",{class:"action-plan mdl-button--icon"}),f.appendChild(r("i",{class:"material-icons"},"insights")),f.onclick=()=>this.actionMap(c),d=t(d,"button",{class:"action-plan mdl-button--icon"}),d.appendChild(r("i",{class:"material-icons"},"airplane_ticket")),d.onclick=()=>this.actionLoad(c)):1===this._listCols.actions?(d=t(d,"button",{class:"action-plan mdl-button--icon"}),d.appendChild(r("i",{class:"material-icons",title:"Download GPX"},"location_on")),d.onclick=()=>this.actionDownloadGPX(c,h)):2===this._listCols.actions&&(d=t(d,"button",{class:"action-plan mdl-button--icon"}),d.appendChild(r("i",{class:"material-icons"},"delete")),d.onclick=()=>{this.mod.removeHistoryEntry(c.id);setTimeout(()=>this.reloadList(),100)})})};R.prototype.actionDownloadFlightTape=async function(a){var b=await this.mod.archive.promiseGet("tapes",a.id);b="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(b.tape));const c=["GeoFS-tape",z(new Date(1E3*a.times.start))];a.flightno&&c.push(a.flightno);c.push(a.orgn);c.push(a.dest);r("a",{href:b,download:c.join("_")+".json"}).click()};R.prototype.actionDownloadGPX=async function(a,b){var c=r("xmlDoc"),d=t(c,"gpx",{xmlns:"http://www.topografix.com/GPX/1/1",version:"1.1",creator:"RandomJobsV"+this.mod.version,"xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd"});const e=t(d,"metadata");e.appendChild(r("name",{},"Flight "+a.flightno+" ("+[a.orgn,a.dest].join("-")+")"));e.appendChild(r("desc",{},["Dist "+Math.round(n.kmToNm(a.dist/1E3))+"NM","Traveled "+Math.round(n.kmToNm(a.traveled/1E3))+"NM","Duration "+[x(Math.floor(b/3600)),x(Math.round(b/60)%60)].join(":"),"Avg kts "+Math.round(n.mpsToKts(a.traveled/b))].join(", ")));const f=t(d,"trk");let h=t(f,"trkseg");if(b=await this.mod.archive.promiseGet("tapes",a.id)){var p=0,A=0;b.tape.forEach(q=>{var k=geofs.api.map._map.distance({lat:p,lng:A},{lat:q[1][0],lng:q[1][1]});1>k||(3E3<k&&(h=t(f,"trkseg")),k=t(h,"trkpt",{lat:q[1][0],lon:q[1][1]}),k.appendChild(r("ele",{},q[1][2])),k.appendChild(r("desc",{},["Speed: "+Math.round(n.mpsToKts(q[4].reduce((w,G)=>w+G,0)))+"kts","Alt: "+Math.round(n.metersToFeet(q[1][2]))+"ft"].join("\n"))),p=q[1][0],A=q[1][1])});if(b=await this.mod.archive.promiseGet("routes",a.id)){const q=t(d,"rte");b.route.forEach(k=>{q.appendChild(r("rtept",{lat:k[0],lon:k[1]}))})}c="data:text/xml;charset=utf-8,"+encodeURIComponent('<?xml version="1.0" encoding="utf-8"?>'+c.innerHTML);d=["GeoFS-flight",z(new Date(1E3*a.times.start))];a.flightno&&d.push(a.flightno);d.push(a.orgn);d.push(a.dest);r("a",{href:c,download:d.join("_")+".gpx"}).click()}};R.prototype.actionLoad=function(a){this.mod.flight.setCurrent(Object.assign({},a));this.window.mainMenuDom.querySelector("li[data-id=flight]").click()};R.prototype.actionMap=function(){ui.panel.show(".geofs-map-list")};let Z=1;(function aa(){if(!Object.keys(g[0]).length&&5>Z)return setTimeout(aa,1E3*Z++);geofs.randomJobs=new I(g,m,"0.8.6.1171");geofs.randomJobs.init(()=>(new O(geofs.randomJobs)).init())})();}).call(this);